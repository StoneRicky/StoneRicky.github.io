<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>strongSwan长期安装笔记 | BlogRicky</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前言由于国家防火墙的不断升级，目前仅存的可访问诸如google.com的方式已经屈指可数，IKEv2由于使用证书加密依然能提供相对较高且比较稳定的速度，strongSwan是一个比较广泛的可提供IKEv2转发的软件服务。 去年2月，通过笔者Quericy前辈的教程，一键安装了5.51版本，但是此后再无更新，而strongSwan已经发布了5.63版本。由于对目前版本的不满意，以及准备更换KVM格式">
<meta property="og:type" content="article">
<meta property="og:title" content="strongSwan长期安装笔记">
<meta property="og:url" content="http://47.104.205.6/hexo/2018/05/30/strongswan-e9-95-bf-e6-9c-9f-e5-ae-89-e8-a3-85-e7-ac-94-e8-ae-b0/index.html">
<meta property="og:site_name" content="BlogRicky">
<meta property="og:description" content="前言由于国家防火墙的不断升级，目前仅存的可访问诸如google.com的方式已经屈指可数，IKEv2由于使用证书加密依然能提供相对较高且比较稳定的速度，strongSwan是一个比较广泛的可提供IKEv2转发的软件服务。 去年2月，通过笔者Quericy前辈的教程，一键安装了5.51版本，但是此后再无更新，而strongSwan已经发布了5.63版本。由于对目前版本的不满意，以及准备更换KVM格式">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-09-11T02:58:44.309Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="strongSwan长期安装笔记">
<meta name="twitter:description" content="前言由于国家防火墙的不断升级，目前仅存的可访问诸如google.com的方式已经屈指可数，IKEv2由于使用证书加密依然能提供相对较高且比较稳定的速度，strongSwan是一个比较广泛的可提供IKEv2转发的软件服务。 去年2月，通过笔者Quericy前辈的教程，一键安装了5.51版本，但是此后再无更新，而strongSwan已经发布了5.63版本。由于对目前版本的不满意，以及准备更换KVM格式">
  
    <link rel="alternate" href="/atom.xml" title="BlogRicky" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">BlogRicky</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">又一个白嫖Blog</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://47.104.205.6/hexo"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-strongswan-e9-95-bf-e6-9c-9f-e5-ae-89-e8-a3-85-e7-ac-94-e8-ae-b0" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/30/strongswan-e9-95-bf-e6-9c-9f-e5-ae-89-e8-a3-85-e7-ac-94-e8-ae-b0/" class="article-date">
  <time datetime="2018-05-30T08:21:57.000Z" itemprop="datePublished">2018-05-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/基础信息/">基础信息</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      strongSwan长期安装笔记
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>由于国家防火墙的不断升级，目前仅存的可访问诸如google.com的方式已经屈指可数，IKEv2由于使用证书加密依然能提供相对较高且比较稳定的速度，<a href="http://www.strongswan.org" target="_blank" rel="noopener">strongSwan</a>是一个比较广泛的可提供IKEv2转发的软件服务。</p>
<p>去年2月，通过笔者Quericy前辈的<a href="https://quericy.me/blog/699/" target="_blank" rel="noopener">教程</a>，一键安装了5.51版本，但是此后再无更新，而strongSwan已经发布了5.63版本。由于对目前版本的不满意，以及准备更换KVM格式的VPS开BBR加速，便考虑了自主寻找安装配置strongSwan的方式。</p>
<p>索性，也是相当无奈的，bandwagon并不提供OpenVZ至KVM的转换，并且也已经超过了退款日期，于是笔者打算今年晚些时候再去购买一台新的VPS，再进行新版本strongSwan的搭建。在此之前，有相当充足的时间供阅读strongSwan的文档及查询问题。</p>
<h2 id="计划"><a href="#计划" class="headerlink" title="计划"></a>计划</h2><p>strongSwan，强壮天鹅，程序也如其名，官网提供了安装包，已经支持了目前大多数的系统，具体大致如下：</p>
<ul>
<li><a href="https://aur.archlinux.org/packages/strongswan/" target="_blank" rel="noopener">Arch Linux</a></li>
<li>[Debian](<a href="http://packages.debian.org/search" target="_blank" rel="noopener">http://packages.debian.org/search</a> keywords=strongswan&amp;searchon=names&amp;suite=all&amp;section=all)</li>
<li><a href="http://packages.ubuntu.com/search?keywords=strongswan&searchon=names&suite=all&section=all" target="_blank" rel="noopener">Ubuntu</a></li>
<li><a href="http://software.opensuse.org/search?p=1&q=strongswan" target="_blank" rel="noopener">openSUSE</a></li>
<li><a href="http://packages.gentoo.org/package/net-misc/strongswan" target="_blank" rel="noopener">Gentoo</a></li>
<li><a href="http://maemo.org/packages/view/strongswan/" target="_blank" rel="noopener">Maemo</a></li>
<li><a href="https://apps.fedoraproject.org/packages/strongswan/overview/" target="_blank" rel="noopener">Fedora</a></li>
<li><a href="http://pkgs.org/download/strongswan" target="_blank" rel="noopener">Red Hat Enterprise Linux and CentOS via EPEL</a></li>
</ul>
<p>笔者对目前常用的系统为CentOS，如果不出意外，将来的安装方式也仅以此为例。</p>
<p>当前strongSwan的最新版本为5.6.3，官方在CentOS6中提供5.4.0的一键安装，在CentOS7提供5.6.2的安装，已经比较接近最新版本。笔者打算在腾讯云服务器搬家完成后，将其重装，进行测试安装，并记录安装过程。虽然目前仍有部分未搬迁完成，但并不妨碍测试安装的进行。</p>
<h2 id="历程"><a href="#历程" class="headerlink" title="历程"></a>历程</h2><p>根据目前官网提供的安装方式，需要先更新源。官方简单粗暴的扔了一个<a href="http://dl.fedoraproject.org/pub/epel/7/x86_64/" target="_blank" rel="noopener">网站</a>，但具体文件还是需要些时间寻找。</p>
<p>通过wget命令下载此文件：</p>
<p>wget <a href="http://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-release-7-11.noarch.rpm" target="_blank" rel="noopener">http://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-release-7-11.noarch.rpm</a></p>
<p>安装源：</p>
<p>rpm -Uvh epel-release-7-11.noarch.rpm</p>
<p>安装strongSwan：</p>
<p>yum install strongswan</p>
<p>至此strongSwan已经安装完成了，相对于编译安装，这种方式明显更简单，但具体是否影响使用还有待考证。</p>
<p>然后我像之前样输入以下代码，查看版本：</p>
<p>ipsec version</p>
<p>返回结果是找不到命令，查阅用户文档后才发现，程序命令已经换为其软件本名，原文如下：</p>
<blockquote>
<p>While the ipsec.conf configuration file is well suited to define IPsec related configuration parameters, it is not useful for other strongSwan applications to read options from this file. The file is hard to parse and only ipsec starter is capable of doing so. As the number of components of the strongSwan project is continually growing, we needed a more flexible configuration file that is easy to extend and can be used by all components. The new configuration format consists of hierarchical sections and a list of key/value pairs in each section. Starting with the strongSwan 4.2.1release, a default strongswan.conf file is installed in your sysconfdir, e.g. <code>/etc/strongswan.conf</code>.</p>
</blockquote>
<h6 id="2018-5-30"><a href="#2018-5-30" class="headerlink" title="2018/5/30"></a>2018/5/30</h6><hr>
<p>于是，问题来了，接下来要做什么？</p>
<p>如文档所描述，强壮天鹅能提供的功能相当的多，仅场景应用就有400多，翻了翻文档可能还是需要学学专业课。那么好吧，先暂时停止一下转发功能的实现，多学习了解一下计算机网络。</p>
<p>《计算机网络》这本课本，基本是把虚拟专用网络该用到的理论都写在了书上，笔者之前考研时也有摸鱼看完了所有相关内容。课本上有提到IKEv2协议，但并没有详细讲解。根据其实现方式，笔者推测应当是非对称加密。</p>
<p>对于未来的一段时间内，笔者会多多学习此方面的内容，再逐渐结合一下实践，争取独立完成strongSwan的配置。</p>
<h6 id="2018-5-31"><a href="#2018-5-31" class="headerlink" title="2018/5/31"></a>2018/5/31</h6><hr>
<p>今天才明白，原来iptables服务除了当作防火墙，还能做转发，充当NAT服务器，CentOS7上与此对应的Firewall服务也具备相同的功能。这就理解了为什么当初手动安装时，没配置防火墙，只能链接但上不去网的现象。</p>
<p>同时笔者在思考如下一件事情的可行性：</p>
<ul>
<li>如果将Quericy前辈的一键安装脚本中strongSwan的安装包链接替换成最新版的，安装是否可以顺利进行。</li>
</ul>
<p>下载脚本：</p>
<p>wget –no-check-certificate <a href="https://raw.githubusercontent.com/quericy/one-key-ikev2-vpn/master/one-key-ikev2.sh" target="_blank" rel="noopener">https://raw.githubusercontent.com/quericy/one-key-ikev2-vpn/master/one-key-ikev2.sh</a></p>
<p>笔者尝试寻找脚本中有关strongSwan的链接，发现其是通过一个函数对版本进行寻找，大概在40%的位置，将原本的5.5.1修改成5.6.3，并在腾讯云的CentOS7的服务器上进行测试。</p>
<p>授权：</p>
<p>chmod +x one-key-ikev2.sh</p>
<p>运行脚本：</p>
<p>bash one-key-ikev2.sh</p>
<p>经过了几次调整，strongSwan得以成功安装，并且生成了证书，但有关虚拟专用网络的三个服务均没有开启。</p>
<p>根据猜测笔者认为有可能是如下原因（按可能性排序）：</p>
<ol>
<li>strongSwan版本变动导致先前针对5.5.1的配置不能照搬操作；</li>
<li>笔者这台腾讯云主机上安装的软件过于繁多，修改过很多系统配置，对strongSwan的服务配置产生影响；</li>
<li>Quericy前辈的脚本针对CentOS7.X有bug。</li>
</ol>
<h6 id="2018-6-1"><a href="#2018-6-1" class="headerlink" title="2018/6/1"></a>2018/6/1</h6><hr>
<p>今日进行了两次尝试，都是在腾讯云CentOS6.8下进行的。</p>
<p>首先是通过修改脚本中StrongSwan版本进行安装，安装成功并且可以连接，但不能访问任何网页，ping也是不通的。</p>
<p>怀疑是版本问题，便重装系统进行原脚本运行，但效果同上次相同。</p>
<p>笔者猜测是腾讯云主机不适配StrongSwan的代理服务，或者KVM与OpenVZ之间选择有误。</p>
<p>2018/6/25</p>
<hr>
<p>7月6日当天，公司摸鱼日，直接去搬瓦工买了一个KVM的VPS，本着死马当活马医的原则，尝试了两次安装。</p>
<p>系统直接选择了搬瓦工CentOS6.8已开启bbr的版本，首先进行了一次原版本安装，尝试启动StrongSwan服务的时候，仅有一条</p>
<p>Starting strongSwan 5.5.1 IPsec [starter]…</p>
<p>不同于之前OpenVZ上弹出的</p>
<p>no netkey IPsec stack detected<br>no KLIPS IPsec stack detected<br>no known IPsec stack detected, ignoring!</p>
<p>但通过VPS访问外网是完全没问题的，方才明白这并不是三项服务，正确的安装本不该弹出如上的三条提醒。</p>
<p>然后笔者又如同上图一样对脚本文件进行了修改，并再次安装，同样可以完美上网。</p>
<p>但实际效果并不是非常尽人意，通过两个VPS之间观看4K视频的对比，KVM并没有比OpenVZ有多少提升，速度在同一数量级。</p>
<p>7月12日当天，上午，公司摸鱼日又进行了一次腾讯云服务器上的5.6.3安装，同样可以安装成功并代理上网。</p>
<p>至此最新版的StongSwan算是安装成功了，以后会整理一个手札方便日后安装。</p>
<p>但这个笔记仍未完结，因为当前尚未能解决的问题还是CentOS7.X上的StrongSwan安装问题。</p>
<p>2018/7/12</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://47.104.205.6/hexo/2018/05/30/strongswan-e9-95-bf-e6-9c-9f-e5-ae-89-e8-a3-85-e7-ac-94-e8-ae-b0/" data-id="ck0eopw5j000rgvywnai3zbzu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/02/28/strongswan-5-6-3-e5-ae-89-e8-a3-85-e6-89-8b-e6-9c-ad-2/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          StrongSwan 5.6.3 安装手札
        
      </div>
    </a>
  
  
    <a href="/2018/05/28/e6-90-ac-e5-ae-b6-2/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">搬家</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Promise/">Promise</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/咸鱼翻身/">咸鱼翻身</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/基础信息/">基础信息</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/普通文章/">普通文章</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/09/10/hexo-github-pages-e7-99-bd-e5-ab-96-e5-8d-9a-e5-ae-a2-e6-90-ad-e5-bb-ba-e6-89-8b-e6-9c-ad/">hexo + github pages 白嫖博客搭建手札</a>
          </li>
        
          <li>
            <a href="/2019/09/09/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2019/04/26/easytrain-e4-bd-bf-e7-94-a8-e6-96-b9-e6-b3-95-e7-a0-94-e7-a9-b6/">EasyTrain使用方法研究</a>
          </li>
        
          <li>
            <a href="/2019/02/28/strongswan-5-6-3-e5-ae-89-e8-a3-85-e6-89-8b-e6-9c-ad-2/">StrongSwan 5.6.3 安装手札</a>
          </li>
        
          <li>
            <a href="/2018/05/30/strongswan-e9-95-bf-e6-9c-9f-e5-ae-89-e8-a3-85-e7-ac-94-e8-ae-b0/">strongSwan长期安装笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 StoneRicky<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>